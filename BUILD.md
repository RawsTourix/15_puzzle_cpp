# BUILD — сборка и зависимости (Visual Studio / MSBuild)

## 0) Открытие проекта через `.vcxproj`

### В Visual Studio
1. Откройте Visual Studio
2. Нажмите:
   - **Открыть проект или решение** на главной странице
   - или **Файл → Открыть → Решение или проект…** в строке меню
3. Visual Studio откроет проект и создаст решение «на лету». При необходимости сохраните его:
   - **Файл → Сохранить всё** → будет создан `*.sln` рядом с проектом.

> **Примечание:** в этом репозитории *по умолчанию* в настройках проекта выбран triplet vcpkg **`x64-windows-static`** (статическая линковка). При необходимости можно переключить на **`x64-windows`** (динамическая сборка) — см. пункты 2.2–2.4.

## 1) Зависимости: SFML

### Требование по стандарту языка
SFML **3.x** требует стандарт **C++17**. Проверьте в Visual Studio:

**Проект → Свойства проекта → Свойства конфигурации → C/C++ → Язык → Стандарт языка C++** → `Стандарт ISO C++17 (/std:c++17)`

---

### Почему NuGet обычно не лучший вариант для нативного C++
В NuGet часто попадаются:
- пакеты **SFML.Net** (это обёртка для .NET/C#, не для нативного C++)
- неофициальные/устаревшие сборки SFML для C++

Для нативного C++ под Visual Studio надёжнее использовать **vcpkg** или ручную установку.

---

### Рекомендуемый способ: vcpkg + интеграция с Visual Studio

#### Установка vcpkg (один раз)
```bat
git clone https://github.com/microsoft/vcpkg
cd vcpkg
bootstrap-vcpkg.bat
```

#### Интеграция с Visual Studio (один раз)
```bat
vcpkg integrate install
```

> Если запускаете команды из PowerShell, для файлов из текущей папки используйте префикс `.\`  
> Например: `.\bootstrap-vcpkg.bat`, `.\vcpkg integrate install`

#### Установка SFML (динамическая линковка, с DLL)
Для x64:
```bat
vcpkg install sfml:x64-windows
```

Для Win32 (x86):
```bat
vcpkg install sfml:x86-windows
```

После этого include/lib пути и линковка обычно подхватываются автоматически через MSBuild-интеграцию.

---

### Альтернатива: SFML вручную
Можно скачать SFML и вручную прописать:
- include директории
- lib директории
- список `.lib` (Debug/Release отличаются, у Debug обычно суффикс `-d`)
- DLL рядом с `.exe`

---

## 2) Статическая сборка (опционально)

**Зачем:** если хотите меньше зависеть от внешних DLL (уменьшает количество внешних DLL проекта).
**Важно:** статическая линковка *не упаковывает* ресурсы (tilemap/скины) в `.exe` — они останутся файлами на диске.

### 2.1 Установить SFML под static-triplet
Для x64:
```bat
vcpkg install sfml:x64-windows-static
```

Для Win32 (x86):
```bat
vcpkg install sfml:x86-windows-static
```

### 2.2 Указать проекту этот triplet
Нужно явно задать:
- **VcpkgTriplet = x64-windows-static**

- или **VcpkgTriplet = x86-windows-static** для Win32

**Проект → Свойства проекта → Свойства конфигурации → vcpkg → Target and Configuration Specific → Triplet**

> (если вкладки **vcpkg** нет, в `.vcxproj` можно установить через свойство **VcpkgTriplet**)

### 2.3 Переключить CRT на /MT и /MTd
Иначе возможен конфликт линковки (`/MD` vs `/MT`).

**Проект → Свойства проекта → Свойства конфигурации → C/C++ → Создание кода → Библиотека времени выполнения**

Выставьте:
- **Debug** → `Многопоточная отладочная (/MTd)`
- **Release** → `Многопоточная (/MT)`

### 2.4 Добавить define `SFML_STATIC`
Путь:
**Проект → Свойства проекта → Свойства конфигурации → C/C++ → Препроцессор → Определения препроцессора**

Добавьте: `SFML_STATIC` (Например: `_DEBUG;_CONSOLE;SFML_STATIC;%(PreprocessorDefinitions)`)

> (нужно добавить, как для **Debug**, так и для **Release**)

### 2.5 Если вылезли LNK2019 с time/joy… → добавить `winmm.lib`
Иногда при статической сборке SFML на Windows нужно явно добавить системную библиотеку.

Путь:
**Проект → Свойства проекта → Свойства конфигурации → Компоновщик → Ввод → Дополнительные зависимости**

Добавьте: `winmm.lib` (Например: `winmm.lib;%(AdditionalDependencies)`)

> (нужно добавить, как для **Debug**, так и для **Release**)

После изменений сделайте:
- **Сборка → Очистить решение**
- **Сборка → Пересобрать решение**

---

## 3) Запуск (важно)

- В текущей версии игра загружает ресурсы с диска (tilemap/скины и т. п.), поэтому рядом с `.exe` должны быть нужные папки/файлы ресурсов.
- При динамической сборке рядом с `.exe` должны быть DLL (vcpkg при MSBuild-интеграции часто копирует их автоматически, но если у вас они не появились — скопируйте вручную из папки установки/сборки SFML).